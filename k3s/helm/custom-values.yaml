# This is a YAML-formatted file.
# Declare variables here to be passed to your templates.

pvvals:
  imageVers:
    graphdb: "pontusvisiongdpr/pontus-track-graphdb-odb${PV_IMAGE_SUFFIX}:1.15.1"
    grafana: "pontusvisiongdpr/grafana${PV_IMAGE_SUFFIX}:1.13.2"
    pvextract: "pontusvisiongdpr/pv-extract-wrapper:1.13.2"

  storagePath: "${PV_STORAGE_BASE}"
  hostname: "${PV_HOSTNAME}"
  # to get the keycloak public key, do an HTTP GET to the following URL: https://<hostname>/auth/realms/pontus
  keycloakPubKey: "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoPXhyc8o2duKqj1joM6bWs7uD2abY0eDoYUp3CXYpS2J7X+sOJywsH40bgFzobCvx8anfS4bu40sPNVilCUwZzDcultr1HRvmWrsBdbXHoHQLT75IM1GvjjjIGTiuyKgr9S1t46/6LiJ8a78aTqkHSDPTleC/QdKRkHMY3mTqqvGb3Wz6BTE+HfDJN74q7mmNgV0qFgYyWuSMgD7Us+5MpS3GpyzNiUC/aPm456sHu/ikINenhkVZ16g9U4O5hwtVKnQvEJMn2gWTjT2BfHvHMwK7iA3W08T4hXxuZUDAy+SSPx8XXyrgSMCQ/tFEZApT335YgXt6kiqSKuVFaUj0wIDAQAB"
  defEnvVars:
    - name: PV_DEBUG
      value: "true"
    - name: PV_TIMEOUT_MS
      value: "1600000"
    - name: PV_GRAPHDB_URL_PREFIX
      value: http://graphdb-nifi:3001
    - name: PV_STATE_FILE
      value: "/mnt/pv-extract-lambda/state.json"
    - name: PV_SHAREPOINT_SITE_ID
      value: "some.sharepoint.com,<GUID1>,<GUID2>"
    - name: PV_OFFICE_365_ONPREM_CREDS_FILE
      value: "/run/secrets/sharepoint-json"
    - name:  PV_MAX_EMAIL_MESSAGES
      value: 1000

  extractModules:
#    sharepoint-consent:
#      command:
#        - /usr/bin/node
#        - dist/office365/sharepoint/app.js
#      storage: 1Mi
#      secretName: "sharepoint-json"
#      env:
#        - name: PV_GRAPHDB_INPUT_JSONPATH
#          value: "$.queryResp[*].fields"
#        - name: PV_SHAREPOINT_LIST_ID
#          value: "<GUID3>"
#        - name: PV_GRAPHDB_INPUT_RULE
#          value: "sharepoint_consents"

    kpi:
      command:
        - /bin/bash
        - -c
        - sleep 10 && getent hosts graphdb-nifi &&  /usr/bin/node dist/kpi-handler/app.js
      env:
        - name: PV_POSTGREST_PREFIX
          value: "http://pontus-postgrest:3000"

    budibase-mapeamento:
      command:
        - /usr/bin/node
        - dist/rest-handler/budibase/app.js
      secretName: "budibase-json"
      storage: 1Mi
      schedule: "*/6 * * * *"
      env:
        - name:  PV_SECRET_MANAGER_ID
          value: budibase-json
        - name:  PV_REQUEST_URL
          value: "${BUDIBASE_URL_MAPEAMENTO}"
        - name:  PV_GRAPHDB_INPUT_RULE
          value: bb_mapeamento_de_processo
        - name:  PV_SECRET_COMPONENT_NAME
          value: budibase
        - name:  PV_GRAPHDB_INPUT_JSONPATH
          value: $.rows
